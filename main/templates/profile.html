{% extends 'base.html' %}

{% block title %}Mental Health Assessment - Mann{% endblock %}

{% block start %}
<style>
    /* Override base styles for mental health profile */
    body {
        background-color: var(--light-bg);
        color: var(--text-color);
    }
    
    .profile-container {
        max-width: 900px;
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(46, 139, 87, 0.1);
        margin: 30px auto;
        border-top: 6px solid var(--primary-color);
    }
    
    .profile-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .profile-title {
        color: var(--primary-color);
        font-size: 32px;
        margin-bottom: 10px;
        position: relative;
        padding-bottom: 15px;
        font-weight: 700;
    }
    
    .profile-title:after {
        content: '';
        position: absolute;
        width: 80px;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 2px;
    }
    
    .profile-subtitle {
        color: var(--muted-text);
        font-size: 18px;
        margin: 0;
        font-weight: 400;
    }
    
    .section-header {
        color: var(--primary-color);
        margin-top: 35px;
        margin-bottom: 20px;
        font-size: 20px;
        font-weight: 600;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--accent-color);
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .section-icon {
        font-size: 24px;
    }
    
    .form-group {
        margin-bottom: 25px;
    }
    
    label {
        font-weight: 600;
        color: var(--text-color);
        display: block;
        margin-bottom: 8px;
        font-size: 16px;
    }
    
    .field-description {
        font-size: 14px;
        color: var(--muted-text);
        margin-bottom: 10px;
        font-style: italic;
    }
    
    input, textarea, select {
        width: 100%;
        padding: 14px;
        box-sizing: border-box;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        background-color: white;
        color: var(--text-color);
        font-family: 'Montserrat', sans-serif;
        font-size: 15px;
        transition: all 0.3s ease;
    }
    
    input:focus, textarea:focus, select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(46, 139, 87, 0.1);
        background-color: var(--light-bg);
    }
    
    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 12px;
        margin-top: 12px;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        background-color: var(--light-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .checkbox-item:hover {
        background-color: var(--light-accent);
        border-color: var(--accent-color);
        transform: translateY(-1px);
    }
    
    .checkbox-item input[type="checkbox"] {
        width: auto;
        margin: 0;
        accent-color: var(--primary-color);
    }
    
    .checkbox-item label {
        margin: 0;
        cursor: pointer;
        font-weight: 500;
    }
    
    .rating-scale {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 12px;
        padding: 15px;
        background-color: var(--light-bg);
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }
    
    .rating-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        padding: 10px;
        border-radius: 8px;
        transition: all 0.2s ease;
    }
    
    .rating-option:hover {
        background-color: white;
    }
    
    .rating-option input[type="radio"] {
        width: auto;
        margin: 0;
        accent-color: var(--primary-color);
    }
    
    .rating-label {
        font-size: 13px;
        text-align: center;
        color: var(--muted-text);
        font-weight: 500;
        line-height: 1.3;
    }
    
    .btn-analyze {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 16px 32px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 18px;
        font-family: 'Montserrat', sans-serif;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 20px;
        box-shadow: 0 4px 15px rgba(46, 139, 87, 0.2);
    }
    
    .btn-analyze:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(46, 139, 87, 0.3);
        background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
    }
    
    /* Analysis Results Styles */
    .analysis-container {
        display: none;
        margin-top: 40px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(46, 139, 87, 0.1);
        border-top: 6px solid var(--accent-color);
        overflow: hidden;
    }
    
    .analysis-header {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .analysis-title {
        font-size: 28px;
        font-weight: 700;
        margin: 0;
    }
    
    .analysis-subtitle {
        font-size: 16px;
        opacity: 0.9;
        margin: 10px 0 0 0;
    }
    
    .analysis-content {
        padding: 40px;
    }
    
    .risk-level {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        padding: 20px;
        border-radius: 15px;
        font-weight: 600;
        font-size: 18px;
    }
    
    .risk-low {
        background: linear-gradient(135deg, #10b981, #34d399);
        color: white;
    }
    
    .risk-moderate {
        background: linear-gradient(135deg, #f59e0b, #fbbf24);
        color: white;
    }
    
    .risk-high {
        background: linear-gradient(135deg, #ef4444, #f87171);
        color: white;
    }
    
    .analysis-section {
        margin-bottom: 35px;
        padding: 25px;
        background: var(--light-bg);
        border-radius: 15px;
        border-left: 5px solid var(--primary-color);
    }
    
    .analysis-section h3 {
        color: var(--primary-color);
        margin: 0 0 15px 0;
        font-size: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .condition-item {
        background: white;
        padding: 15px;
        margin: 10px 0;
        border-radius: 10px;
        border-left: 4px solid var(--accent-color);
    }
    
    .condition-name {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 16px;
    }
    
    .condition-description {
        color: var(--muted-text);
        font-size: 14px;
        margin-top: 5px;
    }
    
    .recommendation-item {
        background: white;
        padding: 20px;
        margin: 15px 0;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .recommendation-title {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 16px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .recommendation-desc {
        color: var(--text-color);
        line-height: 1.6;
    }
    
    .emergency-notice {
        background: linear-gradient(135deg, #ef4444, #f87171);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
        text-align: center;
        font-weight: 600;
    }
    
    .emergency-notice h4 {
        margin: 0 0 10px 0;
    }
    
    .contact-professional {
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: white;
        padding: 25px;
        border-radius: 15px;
        margin-top: 30px;
        text-align: center;
    }
    
    .contact-professional h4 {
        margin: 0 0 15px 0;
        font-size: 20px;
    }
    
    .btn-contact {
        background: white;
        color: var(--primary-color);
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        margin: 5px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-contact:hover {
        background: var(--light-bg);
        transform: translateY(-1px);
    }
    
    .loading-spinner {
        display: none;
        text-align: center;
        margin: 20px 0;
    }
    
    .spinner {
        border: 3px solid var(--light-accent);
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        display: inline-block;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .profile-container, .analysis-container {
            padding: 25px;
            margin: 15px;
        }
        
        .analysis-content {
            padding: 25px;
        }
        
        .profile-title, .analysis-title {
            font-size: 24px;
        }
        
        .checkbox-group {
            grid-template-columns: 1fr;
        }
        
        .rating-scale {
            flex-direction: column;
            gap: 12px;
        }
        
        .rating-option {
            flex-direction: row;
            justify-content: center;
            width: 100%;
        }
    }
</style>

<div class="profile-container">
    <div class="profile-header">
        <h1 class="profile-title">Mental Health Assessment</h1>
        <p class="profile-subtitle">Complete this assessment to receive personalized insights and recommendations</p>
    </div>
    
    <!-- Privacy Notice -->
    <div class="privacy-notice">
        <h4>🔒 Confidential Assessment</h4>
        <p>This assessment is for informational purposes only and does not replace professional medical advice. Your responses are private and will only be used to generate personalized recommendations.</p>
    </div>
    
    <form id="mentalHealthAssessment">
        <!-- Personal Information Section -->
        <div class="section-header">
            <span class="section-icon">👤</span>
            Personal Information
        </div>
        
        <div class="form-group">
            <label for="id_name">First Name *</label>
            <input type="text" name="name" id="id_name" required placeholder="Enter your first name">
        </div>
        
        <div class="form-group">
            <label for="id_age">Age *</label>
            <input type="number" name="age" id="id_age" required min="13" max="120" placeholder="Enter your age">
        </div>
        
        <div class="form-group">
            <label for="id_gender">Gender Identity</label>
            <select name="gender" id="id_gender">
                <option value="">Select gender identity</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Transgender">Transgender</option>
                <option value="Prefer not to say">Prefer not to say</option>
                <option value="Other">Other</option>
            </select>
        </div>
        
        <!-- Mental Health Information Section -->
        <div class="section-header">
            <span class="section-icon">🧠</span>
            Current Symptoms & Concerns
        </div>
        
        <div class="form-group">
            <label>What symptoms are you currently experiencing?</label>
            <div class="field-description">Select all that currently apply to your situation</div>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="anxiety" id="symptom_anxiety">
                    <label for="symptom_anxiety">Excessive worry or anxiety</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="depression" id="symptom_depression">
                    <label for="symptom_depression">Persistent sadness or hopelessness</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="panic" id="symptom_panic">
                    <label for="symptom_panic">Panic attacks or intense fear</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="sleep" id="symptom_sleep">
                    <label for="symptom_sleep">Sleep difficulties (insomnia/oversleeping)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="concentration" id="symptom_concentration">
                    <label for="symptom_concentration">Trouble concentrating or focusing</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="irritability" id="symptom_irritability">
                    <label for="symptom_irritability">Increased irritability or anger</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="energy" id="symptom_energy">
                    <label for="symptom_energy">Low energy or fatigue</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="appetite" id="symptom_appetite">
                    <label for="symptom_appetite">Changes in appetite or weight</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="social" id="symptom_social">
                    <label for="symptom_social">Social withdrawal or isolation</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="symptoms" value="thoughts" id="symptom_thoughts">
                    <label for="symptom_thoughts">Intrusive or racing thoughts</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>How long have you been experiencing these symptoms?</label>
            <select name="duration" id="id_duration" required>
                <option value="">Select duration</option>
                <option value="recent">Less than 2 weeks</option>
                <option value="short">2 weeks to 2 months</option>
                <option value="medium">2-6 months</option>
                <option value="long">6 months to 2 years</option>
                <option value="chronic">More than 2 years</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>How severely are these symptoms affecting your daily life?</label>
            <div class="rating-scale">
                <div class="rating-option">
                    <input type="radio" name="severity" value="1" id="severity_1" required>
                    <label for="severity_1" class="rating-label">Minimal<br>Impact</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="severity" value="2" id="severity_2" required>
                    <label for="severity_2" class="rating-label">Mild<br>Impact</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="severity" value="3" id="severity_3" required>
                    <label for="severity_3" class="rating-label">Moderate<br>Impact</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="severity" value="4" id="severity_4" required>
                    <label for="severity_4" class="rating-label">Significant<br>Impact</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="severity" value="5" id="severity_5" required>
                    <label for="severity_5" class="rating-label">Severe<br>Impact</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="id_triggers">What situations or events tend to make your symptoms worse?</label>
            <textarea name="triggers" id="id_triggers" rows="3" placeholder="Describe your triggers (e.g., work stress, social situations, specific thoughts)"></textarea>
        </div>
        
        <div class="form-group">
            <label for="id_previous_help">Have you sought help for mental health concerns before?</label>
            <select name="previous_help" id="id_previous_help">
                <option value="">Select your experience</option>
                <option value="never">Never sought help</option>
                <option value="therapy_positive">Yes, therapy was helpful</option>
                <option value="therapy_mixed">Yes, therapy had mixed results</option>
                <option value="medication_positive">Yes, medication was helpful</option>
                <option value="medication_mixed">Yes, medication had mixed results</option>
                <option value="both_positive">Yes, both therapy and medication helped</option>
                <option value="unhelpful">Yes, but previous help wasn't effective</option>
            </select>
        </div>
        
        <!-- Support and Lifestyle -->
        <div class="section-header">
            <span class="section-icon">🏠</span>
            Lifestyle & Support
        </div>
        
        <div class="form-group">
            <label>How would you rate your current support system?</label>
            <div class="rating-scale">
                <div class="rating-option">
                    <input type="radio" name="support" value="1" id="support_1" required>
                    <label for="support_1" class="rating-label">Very<br>Limited</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="support" value="2" id="support_2" required>
                    <label for="support_2" class="rating-label">Limited</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="support" value="3" id="support_3" required>
                    <label for="support_3" class="rating-label">Moderate</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="support" value="4" id="support_4" required>
                    <label for="support_4" class="rating-label">Good</label>
                </div>
                <div class="rating-option">
                    <input type="radio" name="support" value="5" id="support_5" required>
                    <label for="support_5" class="rating-label">Excellent</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>Current lifestyle factors affecting your mental health:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="lifestyle" value="stress_work" id="lifestyle_work">
                    <label for="lifestyle_work">High work/school stress</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="lifestyle" value="relationship_issues" id="lifestyle_relationship">
                    <label for="lifestyle_relationship">Relationship problems</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="lifestyle" value="financial_stress" id="lifestyle_financial">
                    <label for="lifestyle_financial">Financial stress</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="lifestyle" value="health_issues" id="lifestyle_health">
                    <label for="lifestyle_health">Physical health problems</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="lifestyle" value="substance_use" id="lifestyle_substance">
                    <label for="lifestyle_substance">Substance use concerns</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" name="lifestyle" value="major_change" id="lifestyle_change">
                    <label for="lifestyle_change">Recent major life changes</label>
                </div>
            </div>
        </div>
        
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner"></div>
            <p style="margin-top: 15px; color: var(--muted-text);">Analyzing your responses...</p>
        </div>
        
        <button type="submit" class="btn-analyze" id="analyzeBtn">
            <i class="bi bi-search me-2"></i>Analyze My Mental Health
        </button>
    </form>
</div>

<!-- Analysis Results Container -->
<div class="analysis-container" id="analysisResults">
    <div class="analysis-header">
        <h2 class="analysis-title">Your Mental Health Analysis</h2>
        <p class="analysis-subtitle">Based on your responses, here are your personalized insights</p>
    </div>
    
    <div class="analysis-content">
        <div id="riskLevel"></div>
        <div id="identifiedConditions"></div>
        <div id="recommendations"></div>
        <div id="professionalHelp"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('mentalHealthAssessment');
    const analysisContainer = document.getElementById('analysisResults');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        performAnalysis();
    });
    
    function performAnalysis() {
        // Show loading spinner
        loadingSpinner.style.display = 'block';
        analyzeBtn.style.display = 'none';
        
        // Simulate analysis delay
        setTimeout(() => {
            const formData = new FormData(form);
            const analysis = analyzeSymptoms(formData);
            displayResults(analysis);
            
            loadingSpinner.style.display = 'none';
            analysisContainer.style.display = 'block';
            analysisContainer.scrollIntoView({ behavior: 'smooth' });
        }, 2000);
    }
    
    function analyzeSymptoms(formData) {
        const symptoms = formData.getAll('symptoms');
        const severity = parseInt(formData.get('severity'));
        const duration = formData.get('duration');
        const support = parseInt(formData.get('support'));
        const lifestyle = formData.getAll('lifestyle');
        const name = formData.get('name');
        
        let analysis = {
            name: name,
            riskLevel: 'low',
            conditions: [],
            recommendations: [],
            urgency: false
        };
        
        // Calculate risk level
        let riskScore = 0;
        if (severity >= 4) riskScore += 3;
        else if (severity >= 3) riskScore += 2;
        else riskScore += 1;
        
        if (duration === 'chronic' || duration === 'long') riskScore += 2;
        if (support <= 2) riskScore += 1;
        if (lifestyle.length >= 3) riskScore += 1;
        
        if (riskScore >= 5) analysis.riskLevel = 'high';
        else if (riskScore >= 3) analysis.riskLevel = 'moderate';
        
        // Check for high-risk symptoms
        const highRiskSymptoms = ['thoughts', 'panic', 'depression', 'social'];
        const hasHighRiskSymptoms = symptoms.some(s => highRiskSymptoms.includes(s));
        if (hasHighRiskSymptoms && severity >= 4) {
            analysis.urgency = true;
            analysis.riskLevel = 'high';
        }
        
        // Identify potential conditions
        if (symptoms.includes('anxiety') || symptoms.includes('panic')) {
            analysis.conditions.push({
                name: 'Anxiety Disorder',
                description: 'You may be experiencing symptoms consistent with anxiety disorders, including generalized anxiety or panic disorder.'
            });
        }
        
        if (symptoms.includes('depression') || (symptoms.includes('energy') && symptoms.includes('social'))) {
            analysis.conditions.push({
                name: 'Depression',
                description: 'Your symptoms suggest possible depression, characterized by persistent low mood and loss of interest in activities.'
            });
        }
        
        if (symptoms.includes('sleep') || symptoms.includes('concentration') || symptoms.includes('irritability')) {
            analysis.conditions.push({
                name: 'Stress-Related Symptoms',
                description: 'You may be experiencing stress-related symptoms that can affect sleep, concentration, and mood regulation.'
            });
        }
        
        if (symptoms.includes('thoughts') || symptoms.includes('concentration')) {
            analysis.conditions.push({
                name: 'Cognitive Difficulties',
                description: 'You may be experiencing cognitive symptoms that affect thinking patterns and mental clarity.'
            });
        }
        
        // Generate recommendations
        analysis.recommendations = generateRecommendations(symptoms, severity, analysis.conditions, lifestyle, support);
        
        return analysis;
    }
    
    function generateRecommendations(symptoms, severity, conditions, lifestyle, support) {
        let recommendations = [];
        
        // Professional help recommendations
        if (severity >= 4) {
            recommendations.push({
                title: '🏥 Seek Professional Help Immediately',
                description: 'Given the severity of your symptoms, it\'s important to consult with a mental health professional as soon as possible. Consider scheduling an appointment with a psychiatrist or psychologist.'
            });
        } else if (severity >= 3) {
            recommendations.push({
                title: '👨‍⚕️ Consider Professional Support',
                description: 'Your symptoms warrant professional attention. Consider therapy (CBT, counseling) or consulting with your primary care doctor about your mental health.'
            });
        }
        
        // Specific symptom management
        if (symptoms.includes('anxiety') || symptoms.includes('panic')) {
            recommendations.push({
                title: '🧘 Anxiety Management Techniques',
                description: 'Practice deep breathing exercises, progressive muscle relaxation, and mindfulness meditation. Try the 4-7-8 breathing technique during anxiety episodes.'
            });
        }
        
        if (symptoms.includes('depression')) {
            recommendations.push({
                title: '🌟 Depression Support Strategies',
                description: 'Maintain a daily routine, engage in regular physical activity, practice gratitude journaling, and stay connected with supportive people. Consider light therapy if seasonal.'
            });
        }
        
        if (symptoms.includes('sleep')) {
            recommendations.push({
                title: '😴 Sleep Hygiene Improvement',
                description: 'Establish a consistent bedtime routine, avoid screens 1 hour before bed, keep your bedroom cool and dark, and avoid caffeine after 2 PM.'
            });
        }
        
        if (symptoms.includes('concentration')) {
            recommendations.push({
                title: '🎯 Improve Focus & Concentration',
                description: 'Try the Pomodoro Technique (25-min focus sessions), eliminate distractions, practice mindfulness exercises, and ensure adequate sleep and nutrition.'
            });
        }
        
        if (symptoms.includes('social')) {
            recommendations.push({
                title: '🤝 Social Connection Building',
                description: 'Start with small social interactions, join interest-based groups or activities, practice self-compassion, and consider social anxiety techniques if needed.'
            });
        }
        
        // Lifestyle recommendations
        if (lifestyle.includes('stress_work')) {
            recommendations.push({
                title: '💼 Work-Life Balance',
                description: 'Set clear boundaries between work and personal time, practice saying no to excessive demands, take regular breaks, and consider discussing workload with your supervisor.'
            });
        }
        
        if (lifestyle.includes('relationship_issues')) {
            recommendations.push({
                title: '💕 Relationship Support',
                description: 'Consider couples or family therapy, practice healthy communication techniques, set boundaries, and work on conflict resolution skills. Individual therapy can also help with relationship patterns.'
            });
        }
        
        if (lifestyle.includes('financial_stress')) {
            recommendations.push({
                title: '💰 Financial Stress Management',
                description: 'Create a budget and financial plan, seek financial counseling if needed, explore assistance programs, and focus on what you can control rather than worrying about uncertainties.'
            });
        }
        
        // Support system recommendations
        if (support <= 2) {
            recommendations.push({
                title: '🌐 Build Your Support Network',
                description: 'Join support groups (online or in-person), volunteer for causes you care about, reconnect with old friends, or participate in community activities to build meaningful connections.'
            });
        }
        
        // General wellness recommendations
        recommendations.push({
            title: '🏃 Physical Wellness',
            description: 'Regular exercise (even 20-30 minutes of walking) can significantly improve mood. Also focus on nutrition, staying hydrated, and limiting alcohol/substance use.'
        });
        
        recommendations.push({
            title: '📱 Digital Wellness',
            description: 'Consider limiting social media use, especially comparison-heavy platforms. Use apps for guided meditation, mood tracking, or mental health support like Headspace, Calm, or Sanvello.'
        });
        
        recommendations.push({
            title: '📚 Self-Help Resources',
            description: 'Read books on mental health like "Feeling Good" by David Burns, "The Anxiety and Worry Workbook" by David Clark, or explore online therapy platforms like BetterHelp or Talkspace.'
        });
        
        return recommendations;
    }
    
    function displayResults(analysis) {
        const name = analysis.name || 'there';
        
        // Display risk level
        const riskLevelHtml = `
            <div class="risk-level risk-${analysis.riskLevel}">
                <span style="font-size: 24px;">
                    ${analysis.riskLevel === 'low' ? '🟢' : analysis.riskLevel === 'moderate' ? '🟡' : '🔴'}
                </span>
                <span>Risk Level: ${analysis.riskLevel.charAt(0).toUpperCase() + analysis.riskLevel.slice(1)}</span>
            </div>
        `;
        document.getElementById('riskLevel').innerHTML = riskLevelHtml;
        
        // Emergency notice for high risk
        let emergencyNotice = '';
        if (analysis.urgency) {
            emergencyNotice = `
                <div class="emergency-notice">
                    <h4>⚠️ Immediate Attention Recommended</h4>
                    <p>Your responses indicate symptoms that warrant immediate professional attention. Please consider contacting a mental health professional, your doctor, or a crisis helpline today.</p>
                    <p><strong>Crisis Resources:</strong><br>
                    • National Suicide Prevention Lifeline: 988<br>
                    • Crisis Text Line: Text HOME to 741741<br>
                    • Emergency Services: 911</p>
                </div>
            `;
        }
        
        // Display identified conditions
        let conditionsHtml = `
            <div class="analysis-section">
                <h3><span>🎯</span> Potential Areas of Concern</h3>
                <p>Hello ${name}, based on your responses, here are some areas that may need attention:</p>
                ${emergencyNotice}
        `;
        
        if (analysis.conditions.length > 0) {
            analysis.conditions.forEach(condition => {
                conditionsHtml += `
                    <div class="condition-item">
                        <div class="condition-name">${condition.name}</div>
                        <div class="condition-description">${condition.description}</div>
                    </div>
                `;
            });
        } else {
            conditionsHtml += `
                <div class="condition-item">
                    <div class="condition-name">General Stress Response</div>
                    <div class="condition-description">While you may not meet criteria for specific conditions, you're experiencing stress responses that can benefit from self-care and coping strategies.</div>
                </div>
            `;
        }
        conditionsHtml += '</div>';
        document.getElementById('identifiedConditions').innerHTML = conditionsHtml;
        
        // Display recommendations
        let recommendationsHtml = `
            <div class="analysis-section">
                <h3><span>💡</span> Personalized Recommendations</h3>
                <p>Here are evidence-based strategies tailored to your specific situation:</p>
        `;
        
        analysis.recommendations.forEach(rec => {
            recommendationsHtml += `
                <div class="recommendation-item">
                    <div class="recommendation-title">${rec.title}</div>
                    <div class="recommendation-desc">${rec.description}</div>
                </div>
            `;
        });
        recommendationsHtml += '</div>';
        document.getElementById('recommendations').innerHTML = recommendationsHtml;
        
        // Professional help section
        const professionalHelpHtml = `
            <div class="contact-professional">
                <h4>🩺 Next Steps for Professional Care</h4>
                <p>While self-help strategies are valuable, professional support can provide personalized treatment and faster recovery.</p>
                
                <div style="margin-top: 20px;">
                    <button class="btn-contact" onclick="window.open('https://www.psychologytoday.com/us/therapists', '_blank')">
                        Find a Therapist
                    </button>
                    <button class="btn-contact" onclick="window.open('https://www.nami.org/help', '_blank')">
                        Local Mental Health Resources
                    </button>
                    <button class="btn-contact" onclick="window.open('https://www.betterhelp.com', '_blank')">
                        Online Therapy Options
                    </button>
                </div>
                
                <div style="margin-top: 25px; font-size: 14px; opacity: 0.9;">
                    <p><strong>Remember:</strong> This analysis is for informational purposes only and doesn't replace professional medical advice. If you're in crisis or having thoughts of self-harm, please seek immediate help.</p>
                </div>
            </div>
        `;
        document.getElementById('professionalHelp').innerHTML = professionalHelpHtml;
    }
    
    // Form validation
    const requiredFields = document.querySelectorAll('input[required], select[required]');
    requiredFields.forEach(field => {
        field.addEventListener('change', function() {
            if (this.value) {
                this.style.borderColor = 'var(--border-color)';
            }
        });
    });
    
    // Add click handlers to checkbox items for better UX
    document.querySelectorAll('.checkbox-item').forEach(item => {
        item.addEventListener('click', function(e) {
            if (e.target.type !== 'checkbox') {
                const checkbox = this.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;
            }
        });
    });
    
    // Add click handlers to rating options for better UX
    document.querySelectorAll('.rating-option').forEach(option => {
        option.addEventListener('click', function(e) {
            if (e.target.type !== 'radio') {
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
            }
        });
    });
    
    // Smooth scrolling for form sections
    document.querySelectorAll('.section-header').forEach(header => {
        header.style.cursor = 'pointer';
        header.addEventListener('click', function() {
            this.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    });
});

// Additional utility functions
function validateForm() {
    const requiredFields = document.querySelectorAll('input[required], select[required]');
    const requiredRadios = ['severity', 'support'];
    let isValid = true;
    
    // Check text inputs and selects
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = '#ef4444';
            isValid = false;
        } else {
            field.style.borderColor = 'var(--border-color)';
        }
    });
    
    // Check radio button groups
    requiredRadios.forEach(name => {
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        const isChecked = Array.from(radios).some(radio => radio.checked);
        if (!isChecked) {
            radios.forEach(radio => {
                radio.closest('.rating-scale').style.borderColor = '#ef4444';
            });
            isValid = false;
        } else {
            radios.forEach(radio => {
                radio.closest('.rating-scale').style.borderColor = 'var(--border-color)';
            });
        }
    });
    
    return isValid;
}

// Update the form submission to include validation
document.getElementById('mentalHealthAssessment').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (validateForm()) {
        performAnalysis();
    } else {
        alert('Please complete all required fields marked with *');
        
        // Scroll to first error
        const firstError = document.querySelector('input[style*="#ef4444"], select[style*="#ef4444"], .rating-scale[style*="#ef4444"]');
        if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
});
</script>
{% endblock %}